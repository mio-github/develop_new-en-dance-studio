以下に、上記の対話から「**新システム設計に反映すべき要点**」を整理してまとめました。

---
### 2. **決済・月謝の処理方式**

#### 決済方法

* **口座引き落とし（ジャックス）**
* **クレジットカード（ジャックス扱いだが別部署）**

  * クレカ失敗 → 自動的に口座引き落としへ切替（ジャックス側で対応）

#### 制御・操作

* 店舗スタッフが生徒ごとに支払い手段をシステムから設定可能。
* ただし、一部の切替はジャックスやシステム会社（アーク）との調整が必要。

#### 店頭支払

* Airペイを使用（現金不可）
* スタッフが手動で「支払い完了処理」を行う

---

### 3. **支払いエラーと履歴管理**

* 支払い履歴は画面で一覧表示可能（クレカ→口座切替も履歴で判別可）
* 二重支払（例：クレカ＋店頭）時は「超過」と表示、次月分にプール
* 問題があると **マイページへのアクセスが停止**

---

### 4. **ブラックリスト機能**

* システム上でフラグ設定可能
* ブラックリスト入り＝強制退会（ただし別処理として記録保持）
* メモ（理由記入欄）は現在なし → 将来的に追加が望ましい

---

### 5. **チケット制**

* 「受け放題コース」「チケット制コース」に分類
* チケットは「永久繰越・譲渡不可・返金不可」
* 大会すると **月末でチケット消滅**
* 群馬・栃木では習い事文化が強く、固定クラス制が主流で運用方針が異なる

---

### 6. **渋谷 vs 群馬・栃木のエリア差分対応**

* コース、規約、決済方法、入会オペレーションが完全に異なる
* 群馬銀行指定の口座引き落とし（ジャックスの集金代行なし）
* 渋谷エリア：マイページ主体
  群馬・栃木：オペレーションに依存、Excel併用

#### 設計方針

* **エリア分離設計（渋谷・横浜 / 群馬・栃木）**

  * 各エリアに対し個別設定、異なる規約、UI切り替え対応
* **メンテ性の高い抽象レイヤー設計**（例：支払いロジック、規約内容などの切替可能設計）

---

### 7. **CSV出力と債権管理**

* 月謝一覧から未納者CSV出力 → スタッフがスプレッドシートで管理
* データ連携機能（抽出・統合・出力）を強化する設計が望ましい

---

### 8. **将来的な設計方針**

* 旧システムがユーザー情報（クレカ・口座）を保持していたが、**新システムでは保持しない**設計が望ましい（セキュリティ・トレンド対応）
* APIベースで決済代行会社と連携

---

## ✅ 優先度の高い対応項目（要仕様化）

| 優先度 | 項目             | 対応内容の方向性           |
| --- | -------------- | ------------------ |
| 高   | エリア分離          | 群馬栃木／渋谷横浜で明確な切り分け  |
| 高   | 支払手段の切替・履歴管理   | 自動／手動の履歴反映、エラー時の通知 |
| 高   | マイページ制御        | 支払状態に応じた自動アクセス制限   |
| 中   | ブラックリスト管理      | フラグ＋理由記入欄追加        |
| 中   | 入会フローの分岐処理     | 規約・説明文等、エリアごとの柔軟切替 |
| 中   | チケットの有効期限・扱い   | 有効期限なし・譲渡不可・大会時消滅  |
| 低   | データ抽出とCSV出力の改善 | ダウンロード可能画面の整理・拡張   |

---

